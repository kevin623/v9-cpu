###论文： IX: A Protected Dataplane Operating System for High Throughput and Low Latency

###摘要：
网络需要快速的传输速度和微秒级的低延迟。我们介绍了IX，一个dataplane OS，它在维持内核可靠性的这一优点的同时能提供较高的IO性能。IX利用硬件虚拟化技术把内核管理和调度功能冲往来处理中分离开。dataplane这种结构建立在原始的零拷贝API和对带宽和往来队列优化基础之上。我们证实IX性能（吞吐量和端到端的延迟）超过LInux。此外，IX改善了广泛部署的吞吐量，关键性能达到原有的3.6倍，延迟降低了两倍。

###论文要点：
数据中心应用正在重新定义系统软件需求。一个单一的应用可能由成百个服务组成，部署在上千台服务器上，能提供更高的性能。新需求包括短消息的高速传输，对于远程请求的微秒级的响应，支持海量连接和操作。拥有坚固的保护模式和富有弹性的资源应用，允许其它应用使用一个集群中的任何一个闲置的资源。
一般看法认为在OS中，需求和网络栈存在不匹配。因此，一些系统绕过内核和在用户空间里的网络栈。当内核绕过上下文切换的瓶颈，它无法平衡数据包传输速率和低延迟。此外，用户级缺少保护。应用bug和崩溃能影响到网络栈和工作。其它系统通过远程内存直接访问来替换TCP/Ip,采用专用的适配器。但这样的适配器只能用在通信两端，只能用在数据中心。
作者提出IX这种os，它打破了高吞吐率，低延迟，强保护和资源有效性这四方面的折衷。IX对数据中心结构进行扩展来支持不可信的，通用目的应用，来满足所有的4个需求。它的设计基于以下原则：控制平面和数据平面分离，由它负责资源配置，供给，调度和监视；Run to completion with adaptive batching；Native, zero-copy API with explicit flow control；Flow consistent, synchronization-free processing
它的架构建立在高性能的中间盒子上，比如防火墙，均衡负载，软件路由。它从运行网络栈和应用逻辑的数据平面分离了控制平面。IX利用沙丘和虚拟硬件去运行数据平面内核，应用受到保护，控制平面独立于数据平面。图1a描述IX架构，专注于控制层和数据层的分离。硬件环境是多核服务器，拥有一个或者多个队列的NICs。IX control plane包括完整linux内核和IXCP。linux内核初始化PCIe设备，比如网络适配器，提供基本的资源分配到数据平面的机制，包括核，内存和网络队列。同样重要，它也提供系统调用和服务，服务必须兼容各种应用，比如文件系统和信号支持。IXCP监视资源利用，数据平面性能，资源分配策略。分配策略涉及到要权衡数据平面性能，能量均衡，协作应用之间的资源共享（当他们负载变化超时）。
在实施中，控制平面是完整的linux内核，数据平面运行在受保护，基于库OS的专用线程上。作者在VMX root ring 0 运行linux内核，这种模式典型用于在虚拟系统中运行管理程序。作者在linux中使用沙丘Dune模式令数据平面作为面向应用的OS运行在non-rootring 0，这种模式典型用于在虚拟系统中运行客户内核。应用程序向通常一样运行在VMX non-root ring 3。这种方法使得数据平面可以直接访问硬件，比如页表和异常，并且访问NICs。此外，它在控制平面，数据平面和不可信的应用代码之间提供完整的，三通的保护。每一个IX数据平面操作时就像一个单一的地址空间中间的OS，在1个共享的，用户级地址空间中支持两种线程类型：elastic threads，它在IX dataplane初始化和网络IO消耗相互作用。background threads后台线程。两种线程都能发布POSIX系统调用，这些系统调用其媒介作用，在转发到linux 内核之前被数据平面进行检查。	     
IX数据平面允许网络栈优化带宽和延迟。它围绕原始的，零拷贝API时间设计。每一个数据平面对一批数据在数据平面内核中执行全部网络处理，这种方法分摊了API开销，改善了局部指令和数据。我们按照负载来设计batch的大小。IX dataplane同时也优化了对于多核的可伸缩性。网络适配器对进来的信息进行哈希处理到不同的队列中。每一个数据平面试了执行控制一系列队列，运行网络栈和单一应用，在常用操作中无需同步信息。IX api来源于POSIX  API,按照通信规则知道设计。libix用户级库包含一个基于事件的API，和流行的libevent库很像，对于现存应用具有较大范围的兼容性。
IX和TCP/IP数据平面比较。在10GBE实验中，在吞吐量方面，IX胜过linux10倍，mTCP1.9倍。在40GBE配置下使用单一的多核套接字，两个IX服务器之间的单向延迟是5.7us，比标准的linux好了4倍。我们实验表明，IX在99%的延迟带宽下，吞吐量是linux3.6倍，它降低了内核时间，从linux的75%降到IX的10%。
IX证明，通过重新访问网络APIs，利用现代网络适配器和多核芯片，我们能够设计出高吞吐率和低延迟，并且安全保护和资源利用高效的系统。它也说明把与性能密切相关的I/O功能从内核中分离出来，我们能建立不同的系统，从而获取高性能，并维持兼容性。
